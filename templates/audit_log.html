{% extends "base.html" %}
{% block title %}Audit Logs{% endblock %}

{% block content %}
<h1><span style="color: #2563eb;">üìù Audit Trail Logs</span></h1>

<form method="get" class="filter-form">
  <label>User:</label>
  <select name="user">
    <option value="">All</option>
    {% for u in users %}
      <option value="{{ u[0] }}">{{ u[0] }}</option>
    {% endfor %}
  </select>

  <label>Action:</label>
  <select name="action">
    <option value="">All</option>
    {% for a in actions %}
      <option value="{{ a[0] }}">{{ a[0]|capitalize }}</option>
    {% endfor %}
  </select>

  <label>Date:</label>
  <input type="date" name="start_date"> to
  <input type="date" name="end_date">
  <button type="submit">üîç Filter</button>
</form>


<p>
  <a href="{{ url_for('download_audit_logs') }}">üì• Download Excel</a> |
  <a href="{{ url_for('home') }}">‚Üê Back to Home</a>
</p>


<table class="audit-table">
  <thead>
    <tr>
      <th>#</th>
      <th>Action</th>
      <th>Filename</th>
      <th>Performed By</th>
      <th>Timestamp</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    {% for log in logs %}
      <tr>
        <td>{{ loop.index }}</td>
        <td><strong>{{ log.action|capitalize }}</strong></td>
        <td>{{ log.sop.filename if log.sop else log.sop_filename or "‚Äî" }}</td>
        <td>{{ log.username }}</td>
        <td>{{ log.timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
        <td>{{ log.notes or '' }}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

{% if not logs %}
  <p>No audit logs found.</p>
{% endif %}
{% endblock %}
